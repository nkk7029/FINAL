<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Steganography and Cryptography Assignment</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    section { border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; }
    input, textarea, select, button, a { display: block; width: 100%; margin: .5rem 0; }
    button, a { cursor: pointer; text-align: center; padding: .5rem; background: #0288d1; color: white; border: none; border-radius: 4px; text-decoration: none; }
    .half { width: 48%; display: inline-block; vertical-align: top; }
    .invisible { display: none; }
    #img, #cover { max-width: 100%; border: 1px solid #ccc; margin-bottom: .5rem; }
    #message-container { border: 1px dashed #0288d1; padding: .5rem; border-radius: 4px; }
    #capacity { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Steganography and Cryptography Assignment 4.0</h1>

  <!-- LSB Steganography -->
  <section id="stego">
    <h2>LSB Steganography</h2>
    <input type="file" id="file" accept="image/*" />
    <div>
      <img id="img" alt="Original Image" class="half" />
      <img id="cover" alt="Stego Image" class="half invisible" />
    </div>
    <textarea id="text" placeholder="Enter message to hide..."></textarea>
    <div id="capacity">(0/0 chars)</div>
    <button id="hide">Hide Message</button>
    <button id="read">Read Message</button>
    <div id="message-container" class="invisible">
      <p>Decoded: <span id="message"></span></p>
      <button id="copy">Copy to Clipboard</button>
    </div>
    <a id="download">Download Stego Image</a>
  </section>

  <!-- Symmetric, Hashing, RSA sections omitted for brevity -->

  <!-- External Libraries -->
  <script src="https://unpkg.com/steganography.js@1.1.0/dist/steganography.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/openpgp@5.7.0/dist/openpgp.min.js"></script>
  <script>
    function handleFileSelect(evt) {
      const original = document.getElementById("img"),
            stegoEl   = document.getElementById("cover"),
            textarea  = document.getElementById("text"),
            messageEl = document.getElementById("message"),
            capacity  = document.getElementById("capacity");
      const files = evt.target.files;
      if (!files || !files[0]) return;
      const f = files[0];
      if (!f.type.match('image.*')) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        original.src = e.target.result;
        stegoEl.classList.add('invisible');
        textarea.value = '';
        messageEl.textContent = '';
        document.getElementById('message-container').classList.add('invisible');
        updateCapacity();
      };
      reader.readAsDataURL(f);
    }

    function copyText() {
      const messageEl = document.getElementById("message");
      const text = messageEl.innerText;
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      document.getElementById('copy').innerText = 'Copied!';
    }

    function hide() {
      const img = document.getElementById("img"),
            cover = document.getElementById("cover"),
            textarea = document.getElementById("text"),
            download = document.getElementById("download");
      if (!img.src || !textarea.value) return;
      cover.src = steg.encode(textarea.value, img.src);
      cover.classList.remove('invisible');
      updateCapacity();
      download.href = cover.src.replace("image/png", "image/octet-stream");
    }

    function read() {
      const img = document.getElementById("img"),
            messageEl = document.getElementById("message"),
            textarea = document.getElementById("text");
      if (!img.src) return;
      const hidden = steg.decode(img.src);
      if (hidden) {
        messageEl.textContent = hidden;
        textarea.value = hidden;
        document.getElementById('message-container').classList.remove('invisible');
        updateCapacity();
      }
    }

    function updateCapacity() {
      const img = document.getElementById('img'),
            textarea = document.getElementById('text'),
            capEl = document.getElementById('capacity');
      if (!img.src) {
        capEl.textContent = '(0/0 chars)';
        return;
      }
      const max = steg.getHidingCapacity(img);
      const used = textarea.value.length;
      capEl.textContent = `(${used}/${max} chars)`;
    }

    window.onload = function(){
      document.getElementById('file').addEventListener('change', handleFileSelect, false);
      document.getElementById('hide').addEventListener('click', hide, false);
      document.getElementById('read').addEventListener('click', read, false);
      document.getElementById('text').addEventListener('keyup', updateCapacity, false);
      document.getElementById('copy').addEventListener('click', copyText, false);
      updateCapacity();
    };
  </script>
</body>
</html>
