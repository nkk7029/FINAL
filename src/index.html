<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Steganography and Cryptography Assignment</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    h1 { text-align: center; }
    section { border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; }
    label, input, textarea, select, button, a { display: block; width: 100%; margin: .5rem 0; }
    button, a.button { cursor: pointer; background: #0288d1; color: white; border: none; padding: .5rem; text-decoration: none; text-align: center; border-radius: 4px; }
    a.download { background: none; color: #0288d1; padding: 0; margin: .5rem 0; }
  </style>
</head>
<body>
  <h1>Steganography and Cryptography Assignment</h1>

  <!-- LSB Steganography -->
  <section id="stego">
    <h2>LSB Steganography</h2>
    <p>Skip first <strong>100 bytes</strong> and embed every <strong>8th bit</strong> (L = 8).</p>
    <label>Carrier File:</label>
    <input type="file" id="carrierInput" />
    <label>Message to Hide:</label>
    <textarea id="secretMsg" placeholder="Enter your secret message..."></textarea>
    <button id="encodeBtn" class="button">Embed &amp; Download Stego File</button>
    <a id="downloadLink" class="download" style="display:none"></a>
    <hr/>
    <button id="decodeBtn" class="button">Extract Hidden Message</button>
    <p id="decoded"></p>
  </section>

  <!-- Symmetric Encryption -->
  <section id="symmetric">
    <h2>Symmetric Encryption (AES / 3DES)</h2>
    <label>Algorithm:</label>
    <select id="symAlgo">
      <option value="AES">AES</option>
      <option value="3DES">3DES</option>
    </select>
    <label>Passphrase:</label>
    <input type="password" id="symKey" placeholder="Password / Passphrase" />
    <label>File to Encrypt:</label>
    <input type="file" id="symFile" />
    <button id="encryptSym" class="button">Encrypt File</button>
    <a id="symDownloadLink" class="download" style="display:none"></a>
    <hr/>
    <label>File to Decrypt:</label>
    <input type="file" id="symEncryptedFile" />
    <button id="decryptSym" class="button">Decrypt File</button>
    <a id="symDecryptLink" class="download" style="display:none"></a>
  </section>

  <!-- Hashing -->
  <section id="hashing">
    <h2>Hashing (SHA-256 / SHA-3)</h2>
    <label>Algorithm:</label>
    <select id="hashAlgo">
      <option value="SHA256">SHA-256</option>
      <option value="SHA3">SHA-3</option>
    </select>
    <label>File to Hash:</label>
    <input type="file" id="hashFile" />
    <button id="doHash" class="button">Compute Hash</button>
    <label>Hash Output (hex):</label>
    <textarea id="hashOutput" readonly></textarea>
  </section>

  <!-- Asymmetric RSA -->
  <section id="rsa">
    <h2>Asymmetric RSA (2048-bit)</h2>
    <button id="genRSA" class="button">Generate Keypair</button>
    <label>Public Key (PEM):</label>
    <textarea id="publicKey" readonly></textarea>
    <label>Private Key (PEM):</label>
    <textarea id="privateKey" readonly></textarea>
    <label>File to Encrypt:</label>
    <input type="file" id="rsaFile" />
    <button id="encryptRSA" class="button">Encrypt File</button>
    <a id="rsaDownloadLink" class="download" style="display:none"></a>
    <hr/>
    <label>File to Decrypt:</label>
    <input type="file" id="rsaEncryptedFile" />
    <button id="decryptRSA" class="button">Decrypt File</button>
    <a id="rsaDecryptLink" class="download" style="display:none"></a>
  </section>

  <!-- Libraries -->
  <script src="https://unpkg.com/steganography.js@1.1.0/dist/steganography.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/openpgp@5.7.0/dist/openpgp.min.js"></script>
  <script>
    const SKIP_BYTES = 100;
    const STEP_BITS  = 8; // L = every 8th bit

    function bufferToBits(buf) {
      const bytes = new Uint8Array(buf), bits = [];
      bytes.forEach(b => { for (let i = 7; i >= 0; i--) bits.push((b >> i) & 1); });
      return bits;
    }
    function bitsToBuffer(bits) {
      const len = Math.floor(bits.length / 8), bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        let byte = 0;
        for (let j = 0; j < 8; j++) byte = (byte << 1) | bits[i * 8 + j];
        bytes[i] = byte;
      }
      return bytes.buffer;
    }
    function embedBuffers(carrierBuf, messageBuf) {
      const cBits = bufferToBits(carrierBuf), mBits = bufferToBits(messageBuf);
      const skip = SKIP_BYTES * 8;
      mBits.forEach((bit, i) => { const pos = skip + i * STEP_BITS; if (pos < cBits.length) cBits[pos] = bit; });
      return bitsToBuffer(cBits);
    }
    function extractBuffer(stegoBuf) {
      const bits = bufferToBits(stegoBuf), out = [];
      const skip = SKIP_BYTES * 8;
      for (let pos = skip; pos < bits.length; pos += STEP_BITS) out.push(bits[pos]);
      return bitsToBuffer(out);
    }
    // Stego handlers
    document.getElementById('encodeBtn').onclick = () => {
      const carrierFile = document.getElementById('carrierInput').files[0];
      const msgTxt = document.getElementById('secretMsg').value;
      if (!carrierFile || !msgTxt) return alert('Select carrier file and enter message');
      const fr = new FileReader();
      fr.onload = () => {
        const carrierBuf = fr.result;
        const msgBuf = new TextEncoder().encode(msgTxt).buffer;
        const stegoBuf = embedBuffers(carrierBuf, msgBuf);
        const ext = carrierFile.name.includes('.') ? carrierFile.name.substring(carrierFile.name.lastIndexOf('.')) : '';
        const base = carrierFile.name.replace(/(\.[^\.]+)$/, '');
        const name = `${base}_stego${ext}`;
        const blob = new Blob([stegoBuf], { type: carrierFile.type || 'application/octet-stream' });
        const link = document.getElementById('downloadLink');
        link.href = URL.createObjectURL(blob);
        link.download = name;
        link.textContent = `⬇️ Download ${name}`;
        link.style.display = 'block';
      };
      fr.readAsArrayBuffer(carrierFile);
    };
    document.getElementById('decodeBtn').onclick = () => {
      const carrierFile = document.getElementById('carrierInput').files[0];
      if (!carrierFile) return alert('Select stego file in carrier input');
      const fr = new FileReader();
      fr.onload = () => {
        const extractedBuf = extractBuffer(fr.result);
        const msg = new TextDecoder().decode(extractedBuf);
        document.getElementById('decoded').textContent = msg;
      };
      fr.readAsArrayBuffer(carrierFile);
    };
    // Symmetric handlers
    function downloadSym(blob, name, id) {
      const url = URL.createObjectURL(blob);
      const link = document.getElementById(id);
      link.href = url; link.download = name;
      link.textContent = `⬇️ Download ${name}`; link.style.display = 'block';
    }
    document.getElementById('encryptSym').onclick = () => {
      const algo = document.getElementById('symAlgo').value, key = document.getElementById('symKey').value;
      const file = document.getElementById('symFile').files[0]; if (!file || !key) return alert('Select file and passphrase');
      const fr = new FileReader(); fr.onload = () => {
        const wa = CryptoJS.lib.WordArray.create(fr.result);
        const fn = algo === 'AES' ? CryptoJS.AES.encrypt : CryptoJS.TripleDES.encrypt;
        const ct = fn(wa, key).toString();
        downloadSym(new Blob([ct], { type: 'application/octet-stream' }), 'sym_encrypted.txt', 'symDownloadLink');
      }; fr.readAsArrayBuffer(file);
    };
    document.getElementById('decryptSym').onclick = () => {
      const algo = document.getElementById('symAlgo').value, key = document.getElementById('symKey').value;
      const file = document.getElementById('symEncryptedFile').files[0]; if (!file || !key) return alert('Select encrypted file and passphrase');
      const fr = new FileReader(); fr.onload = () => {
        const ct = new TextDecoder().decode(fr.result);
        const fn = algo === 'AES' ? CryptoJS.AES.decrypt : CryptoJS.TripleDES.decrypt;
        const pt = fn(ct, key).toString(CryptoJS.enc.Utf8);
        downloadSym(new Blob([pt], { type: 'application/octet-stream' }), 'sym_decrypted.txt', 'symDecryptLink');
      }; fr.readAsArrayBuffer(file);
    };
    // Hashing handler
    document.getElementById('doHash').onclick = () => {
      const algo = document.getElementById('hashAlgo').value;
      const file = document.getElementById('hashFile').files[0]; if (!file) return alert('Select file to hash');
      const fr = new FileReader(); fr.onload =
